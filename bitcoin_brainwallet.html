<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin Wallet Generator</title>
    <script>
        // Inline bs58 library
        (function(root, factory) {
            if (typeof define === 'function' && define.amd) {
                define([], factory);
            } else if (typeof exports === 'object') {
                module.exports = factory();
            } else {
                root.bs58 = factory();
            }
        }(this, function() {
            const ALPHABET = '123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz';
            const ALPHABET_MAP = {};
            let BASE = ALPHABET.length;
            let LEADER = ALPHABET.charAt(0);

            for (let z = 0; z < ALPHABET.length; z++) {
                ALPHABET_MAP[ALPHABET.charAt(z)] = z;
            }

            function encode(source) {
                if (source.length === 0) return '';

                let digits = [0];
                for (let i = 0; i < source.length; i++) {
                    let carry = source[i];
                    for (let j = 0; j < digits.length; ++j) {
                        carry += digits[j] << 8;
                        digits[j] = carry % BASE;
                        carry = (carry / BASE) | 0;
                    }

                    while (carry) {
                        digits.push(carry % BASE);
                        carry = (carry / BASE) | 0;
                    }
                }

                let string = '';

                for (let k = 0; source[k] === 0 && k < source.length - 1; ++k) {
                    string += LEADER;
                }

                for (let q = digits.length - 1; q >= 0; --q) {
                    string += ALPHABET[digits[q]];
                }

                return string;
            }

            return {
                encode: encode
            };
        }));

        async function sha256(message) {
            const msgBuffer = typeof message === 'string' ? new TextEncoder().encode(message) : message;
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            return Array.from(new Uint8Array(hashBuffer));
        }

        function bytesToHex(bytes) {
            return bytes.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        function hexToBytes(hex) {
            const bytes = [];
            for (let c = 0; c < hex.length; c += 2) {
                bytes.push(parseInt(hex.substr(c, 2), 16));
            }
            return bytes;
        }

        function concatUint8Arrays(arrays) {
            let totalLength = arrays.reduce((acc, value) => acc + value.length, 0);
            let result = new Uint8Array(totalLength);
            let length = 0;
            for (let array of arrays) {
                result.set(array, length);
                length += array.length;
            }
            return result;
        }

        async function generateBrainWalletKey(passphrase) {
            console.log("Generating Bitcoin Wallet...");

            // Step 1: Generate SHA256 Hash
            const sha256HashBytes = await sha256(passphrase);
            console.log("SHA256 Hash: ", bytesToHex(sha256HashBytes));

            // Step 2: Create Extended Key (add 0x80 prefix)
            const extendedKeyBytes = [0x80].concat(sha256HashBytes);
            console.log("Extended Key: ", bytesToHex(extendedKeyBytes));

            // Step 3: Double SHA256 on the Extended Key
            const doubleSha256HashBytes = await sha256(await sha256(new Uint8Array(extendedKeyBytes)));
            console.log("Double SHA256: ", bytesToHex(doubleSha256HashBytes));

            // Step 4: Create Checksum (first 4 bytes of Double SHA256)
            const checksum = doubleSha256HashBytes.slice(0, 4);
            console.log("Checksum: ", bytesToHex(checksum));

            // Step 5: Create Final Key (Extended Key + Checksum)
            const finalKeyBytes = concatUint8Arrays([extendedKeyBytes, checksum]);
            console.log("Final Key: ", bytesToHex(finalKeyBytes));

            // Step 6: Encode Final Key with bs58
            const wifKey = bs58.encode(finalKeyBytes);
            console.log("WIF Key: ", wifKey);

            return wifKey;
        }

        async function handleFormSubmit(event) {
            event.preventDefault();
            const passphrase = document.getElementById('passphrase').value;
            const wifKey = await generateBrainWalletKey(passphrase);
            if (wifKey) {
                document.getElementById('wifKey').textContent = 'Private Key (WIF): ' + wifKey;
            }
        }
    </script>
</head>
<body>
    <h1>Bitcoin Wallet Generator</h1>
    <form onsubmit="handleFormSubmit(event)">
        <label for="passphrase">Enter your passphrase:</label>
        <input type="text" id="passphrase" name="passphrase" required>
        <button type="submit">Generate</button>
    </form>
    <p id="wifKey"></p>
</body>
</html>
