<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin Wallet Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script>
        // Inline bs58 library
        (function(root, factory) {
            if (typeof define === 'function' && define.amd) {
                define([], factory);
            } else if (typeof exports === 'object') {
                module.exports = factory();
            } else {
                root.bs58 = factory();
            }
        }(this, function() {
            const ALPHABET = '123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz';
            const ALPHABET_MAP = {};
            let BASE = ALPHABET.length;
            let LEADER = ALPHABET.charAt(0);

            for (let z = 0; z < ALPHABET.length; z++) {
                ALPHABET_MAP[ALPHABET.charAt(z)] = z;
            }

            function encode(source) {
                if (source.length === 0) return '';

                let digits = [0];
                for (let i = 0; i < source.length; i++) {
                    let carry = source[i];
                    for (let j = 0; j < digits.length; ++j) {
                        carry += digits[j] << 8;
                        digits[j] = carry % BASE;
                        carry = (carry / BASE) | 0;
                    }

                    while (carry) {
                        digits.push(carry % BASE);
                        carry = (carry / BASE) | 0;
                    }
                }

                let string = '';

                for (let k = 0; source[k] === 0 && k < source.length - 1; ++k) {
                    string += LEADER;
                }

                for (let q = digits.length - 1; q >= 0; --q) {
                    string += ALPHABET[digits[q]];
                }

                return string;
            }

            function decode(string) {
                if (string.length === 0) return [];

                let bytes = [0];
                for (let i = 0; i < string.length; i++) {
                    let value = ALPHABET_MAP[string[i]];
                    if (value === undefined) throw new Error('Non-base58 character');

                    let carry = value;
                    for (let j = 0; j < bytes.length; ++j) {
                        carry += bytes[j] * BASE;
                        bytes[j] = carry & 0xff;
                        carry >>= 8;
                    }

                    while (carry > 0) {
                        bytes.push(carry & 0xff);
                        carry >>= 8;
                    }
                }

                for (let k = 0; string[k] === LEADER && k < string.length - 1; ++k) {
                    bytes.push(0);
                }

                return bytes.reverse();
            }

            return {
                encode: encode,
                decode: decode
            };
        }));

        // JavaScript functions to generate keys and addresses
        function generateBrainWalletKey(passphrase) {
            alert("generateBrainWalletKey is running..."); // Debugging alert
            const sha256Hash = CryptoJS.SHA256(passphrase).toString(CryptoJS.enc.Hex);
            const extendedKey = '80' + sha256Hash;
            const doubleSha256 = CryptoJS.SHA256(CryptoJS.SHA256(CryptoJS.enc.Hex.parse(extendedKey)).toString()).toString();
            const checksum = doubleSha256.slice(0, 8);
            const finalKey = extendedKey + checksum;
            const wifKey = bs58.encode(Buffer.from(finalKey, 'hex'));
            return [sha256Hash, wifKey];
        }

        function privateKeyToAddress(privateKeyBytes) {
            alert("privateKeyToAddress is running..."); // Debugging alert
            const publicKey = '04' + privateKeyBytes;
            const sha256Hash = CryptoJS.SHA256(publicKey).toString(CryptoJS.enc.Hex);
            const ripemd160 = CryptoJS.RIPEMD160(CryptoJS.enc.Hex.parse(sha256Hash)).toString(CryptoJS.enc.Hex);
            const mainnetAddress = '00' + ripemd160;
            const doubleSha256 = CryptoJS.SHA256(CryptoJS.SHA256(CryptoJS.enc.Hex.parse(mainnetAddress)).toString()).toString();
            const checksum = doubleSha256.slice(0, 8);
            const finalAddress = mainnetAddress + checksum;
            const btcAddress = bs58.encode(Buffer.from(finalAddress, 'hex'));
            return btcAddress;
        }

        function handleFormSubmit(event) {
            event.preventDefault();
            alert("handleFormSubmit is running..."); // Debugging alert
            const passphrase = document.getElementById('passphrase').value;
            const [privateKeyBytes, wifKey] = generateBrainWalletKey(passphrase);
            alert("WIF Key: " + wifKey); // Debugging alert
            const btcAddress = privateKeyToAddress(privateKeyBytes);
            alert("BTC Address: " + btcAddress); // Debugging alert
            document.getElementById('wifKey').textContent = 'Private Key (WIF): ' + wifKey;
            document.getElementById('btcAddress').textContent = 'Bitcoin Address: ' + btcAddress;
        }
    </script>
</head>
<body>
    <h1>Bitcoin Wallet Generator</h1>
    <form onsubmit="handleFormSubmit(event)">
        <label for="passphrase">Enter your passphrase:</label>
        <input type="text" id="passphrase" name="passphrase" required>
        <button type="submit">Generate</button>
    </form>
    <p id="wifKey"></p>
    <p id="btcAddress"></p>
</body>
</html>
